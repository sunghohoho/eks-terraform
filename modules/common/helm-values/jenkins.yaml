serviceAccount: 
  create: true
  name: jenkins

persistence:
  enabled: true
  existingClaim: "jenkins-pvc"
  storageClass: "gp3"

controller:
  # initContainerEnv:
  #   - name: JAVA_OPTS
  #     value: "-Dhudson.model.UpdateCenter.xmlUrl=https://updates.jenkins.io/update-center.json"
  updateCenterUrl: "https://updates.jenkins.io/update-center.json"
  jenkinsUrlProtocol: https
  jenkinsUrl: jenkins.gguduck.com
  admin:
    password: ${server_admin_password}
  ingress:
    enabled: true
    ingressClassName: alb
    hostname: jenkins.gguduck.com
    annotations:
      alb.ingress.kubernetes.io/load-balancer-name: jenkins
      alb.ingress.kubernetes.io/scheme: internet-facing
      alb.ingress.kubernetes.io/target-type: ip
      alb.ingress.kubernetes.io/certificate-arn: ${cert_arn}
      external-dns.alpha.kubernetes.io/hostname: jenkins.gguduck.com
  additionalPlugins:
  - github:1.40.0
  - github-branch-source:1807.v50351eb_7dd13
  - job-dsl:1.89
  - pipeline-utility-steps:2.17.0
  - dark-theme:479.v661b_1b_911c01
  JCasC:
    configScripts:
      jenkins-casc-configs: |
        credentials:
          system:
            domainCredentials:
            - credentials:
              - usernamePassword:
                  id: "github"
                  description: "GitHub (sunghohoho)"
                  scope: GLOBAL
                  username: ${github_username}
                  password: ${github_token}
              - string:
                  id: "github-token"
                  scope: GLOBAL
                  description: "GitHub Token for managed hook auth"
                  secret: ${github_token}
        jobs:
          - script: |
              pipelineJob('cats-and-dogs') {
                description('')
                keepDependencies(false)
                properties {
                  githubProjectUrl('https://github.com/sunghohoho/cats-dogs-source/')
                  pipelineTriggers {
                    triggers {
                      githubPush()
                    }
                  }
                }
                definition {
                  cpsScm {
                    scm {
                      git {
                        remote {
                          url('https://github.com/sunghohoho/cats-dogs-source.git')
                          credentials('github')  
                        }
                        branch('*/main') 
                        extensions {}  
                      }
                    }
                    scriptPath('Jenkinsfile')  
                    lightweight(true)  
                  }
                }
                disabled(false)
              }
          - script: |    
              pipelineJob('cats-and-dogs-helm') {
                description('Helm charts are packaged and pushed to ECR Helm OCI when the GitHub repository is updated.')
                keepDependencies(false)
                properties {
                  githubProjectUrl('https://github.com/sunghohoho/cats-and-dogs-helm/')
                  pipelineTriggers {
                    triggers {
                      githubPush()
                    }
                  }
                }
                definition {
                  cpsScm {
                    scm {
                      git {
                        remote {
                          url('https://github.com/sunghohoho/cats-and-dogs-helm.git')
                          credentials('github')  
                        }
                        branch('*/main') 
                        extensions {}  
                      }
                    }
                    scriptPath('Jenkinsfile')  
                    lightweight(true)  
                  }
                }
                disabled(false)
              }
        unclassified:
          githubpluginconfig:
            configs:
            - credentialsId: "github-token"
              name: "sunghohoho"
              apiUrl: "https://api.github.com"
              manageHooks: true

agent:
  podTemplates:
    kaniko: |
      - name: kaniko
        namespace: jenkins
        label: kaniko
        serviceAccount: jenkins
        containers:
        - name: kaniko
          image: gcr.io/kaniko-project/executor:debug
          ttyEnabled: true
          privileged: true
          command: /busybox/cat
    helm: |
      - name: helm
        namespace: jenkins
        label: helm
        serviceAccount: jenkins
        containers:
        - name: helm
          image: alpine/helm:3.11.1
          ttyEnabled: true
          privileged: true
          command: sleep
          args: 99999999
        - name: aws
          image: amazon/aws-cli
          ttyEnabled: true
          privileged: true
          command: sleep
          args: 99999999  
